FROM odaniait/job-framework:latest
MAINTAINER Mike Petersen <mike@odania-it.de>

RUN apk update && apk --no-cache add vim curl autoconf zlib-dev unzip bzip2 ca-certificates libffi-dev gdbm openssl-dev yaml-dev procps duplicity ncftp make \
									bison readline-dev libxml2-dev git docker xfsprogs net-tools py-pip python-dev ansible gcc python-dev python3 \
									linux-headers musl-dev iproute2 htop strace sshpass \
									ruby ruby-json ruby-io-console ruby-irb ruby-rake ruby-bundler ruby-dev && \
						rm -rf /var/cache/apk/*

# Add repo for runit & mongodb
RUN echo "@edge http://dl-cdn.alpinelinux.org/alpine/edge/main" >> /etc/apk/repositories
RUN echo "@edge http://dl-cdn.alpinelinux.org/alpine/edge/community" >> /etc/apk/repositories
RUN echo "@edge http://dl-cdn.alpinelinux.org/alpine/edge/testing" >> /etc/apk/repositories
RUN apk update && apk --no-cache add mongodb-tools@edge && \
						rm -rf /var/cache/apk/*

# Allow installation of ansible
RUN echo "jenkins ALL=(root) NOPASSWD:/usr/bin/pip install ansible" >> /etc/sudoers

ENV START_DOCKER true
